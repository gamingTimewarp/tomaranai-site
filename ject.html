<!DOCTYPE html>
<html lang="en">
<head>
  <script src="redirect.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tomaranai Project — Visual Novels & Short Stories</title>
  <link rel="canonical" href="https://tomaranai.pro/ject.html" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- ===== NAVIGATION ===== -->
  <nav class="nav">
    <a href="ject.html" class="nav-logo"><ruby>
            止まらない<rt>TOMARANAI</rt>
        </ruby> PROJECT</a>
    <button class="nav-hamburger" onclick="document.querySelector('.nav-links').classList.toggle('nav-open')" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <ul class="nav-links">
      <li><a href="ject.html" class="active">Home</a></li>
      <li><a href="stories.html">Stories</a></li>
      <li><a href="blog.html">Blog</a></li>
      <li><a href="projects.html">Projects</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <!-- ===== HERO ===== -->
  <header class="hero">
    <div class="hero-label">Learn about the unstoppable feats of humanity's heroes, ancient, modern, and future.</div>
    <h1 class="hero-title"><span class="hero-accent">the <ruby>止まらない<rt>TOMARANAI</rt></ruby> PROJECT</a></span></h1><h2><br/>& other stories by @gamingTimewarp</h2>
    <p class="hero-sub">Come for silly sci-fi and science fantasy stories about silly characters, stay for deep explorations into the human condition.</p>
  </header>

  <!-- ===== SEARCH ===== -->
  <div class="search-container">
    <div class="search-box">
      <input type="text" id="search-input" class="search-input" placeholder="Search for a post" oninput="filterCards()" autocomplete="off" />
      <span class="search-icon">⌕</span>
    </div>
    <p class="search-results" id="search-results"></p>
  </div>

  <!-- ===== FEATURED SECTION ===== -->
  <main class="content">

    <!-- Stories Preview -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <button class="section-collapse-btn" onclick="collapseSection(this)" aria-label="Collapse section">▼           Latest Stories</button>
        </h2>
        <a href="stories.html" class="section-link">View all →</a>
      </div>
      <div class="card-grid">
        <!-- Content loaded dynamically by home-content.js -->
      </div>
      <button class="section-toggle" onclick="toggleSection(this)">Show more</button>
    </section>

    <!-- Blog Preview -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <button class="section-collapse-btn" onclick="collapseSection(this)" aria-label="Collapse section">▼          From the Blog</button>
        </h2>
        <a href="blog.html" class="section-link">View all →</a>
      </div>
      <div class="card-grid">
        <!-- Content loaded dynamically by home-content.js -->
      </div>
      <button class="section-toggle" onclick="toggleSection(this)">Show more</button>
    </section>


    <!-- Projects Preview -->
    <section class="section">
      <div class="section-header">
        <h2 class="section-title">
          <button class="section-collapse-btn" onclick="collapseSection(this)" aria-label="Collapse section">▼          Other Projects</button>
        </h2>
        <a href="projects.html" class="section-link">View all →</a>
      </div>
      <div class="card-grid">
        <!-- Content loaded dynamically by home-content.js -->
      </div>
      <button class="section-toggle" onclick="toggleSection(this)">Show more</button>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter-section">
      <h2>Stay Updated</h2>
      <p>Get notified when new stories drop, projects launch, or when I have something interesting to share.</p>
      <form
        action="https://buttondown.com/api/emails/embed-subscribe/gamingTimewarp"
        method="post"
        target="popupwindow"
        onsubmit="window.open('https://buttondown.com/gamingTimewarp', 'popupwindow')"
        class="newsletter-form"
      >
        <input type="email" name="email" placeholder="your@email.com" required />
        <button type="submit">Subscribe</button>
      </form>
      <p class="newsletter-note">Powered by <a href="https://buttondown.com" target="_blank">Buttondown</a></p>
    </section>

  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="footer">
    <div class="footer-newsletter">
      <span class="footer-newsletter-label">Subscribe to updates</span>
      <form
        action="https://buttondown.com/api/emails/embed-subscribe/gamingTimewarp"
        method="post"
        target="popupwindow"
        onsubmit="window.open('https://buttondown.com/gamingTimewarp', 'popupwindow')"
        class="newsletter-form"
      >
        <input type="email" name="email" placeholder="your@email.com" required />
        <button type="submit">Subscribe</button>
      </form>
    </div>
    <div class="footer-bottom">
      <p class="footer-text">© 2026 @gamingTimewarp. Built with HTML, CSS, and an unhealthy amount of stimulants.</p>
      <div class="footer-links">
        <a href="https://github.com/gamingTimewarp" target="_blank">GitHub</a>
        <a href="mailto:gamingTimewarp@tomaranai.pro">Email</a>
      </div>
    </div>
  </footer>


  <!-- ===== SCRIPTS ===== -->
  <script>
    const MAX_VISIBLE = 4;

    // --- COLLAPSE: hide cards beyond MAX_VISIBLE in each section on page load ---
    function initCollapse() {
      document.querySelectorAll('.section').forEach(section => {
        const cards = section.querySelectorAll('.card');
        const toggle = section.querySelector('.section-toggle');

        // Only show the button if there are more cards than the limit
        if (cards.length <= MAX_VISIBLE) {
          if (toggle) toggle.style.display = 'none';
          return;
        }

        cards.forEach((card, i) => {
          if (i >= MAX_VISIBLE) {
            card.classList.add('card--hidden');
          }
        });
      });
    }

    // --- TOGGLE: expand or collapse a section ---
    function toggleSection(btn) {
      const section = btn.closest('.section');
      const cards = section.querySelectorAll('.card');
      const isExpanded = btn.textContent === 'Show less';

      cards.forEach((card, i) => {
        if (i >= MAX_VISIBLE) {
          card.classList.toggle('card--hidden', isExpanded);
        }
      });

      btn.textContent = isExpanded ? 'Show more' : 'Show less';
    }

    // --- COLLAPSE: collapse or expand entire section ---
    function collapseSection(btn) {
      const section = btn.closest('.section');
      const cardGrid = section.querySelector('.card-grid');
      const toggle = section.querySelector('.section-toggle');
      const viewAllLink = section.querySelector('.section-link');
      const isCollapsed = btn.textContent === '▶';

      if (isCollapsed) {
        // Expand section
        btn.textContent = '▼';
        if (cardGrid) cardGrid.style.display = '';
        if (toggle) toggle.style.display = '';
        if (viewAllLink) viewAllLink.style.display = '';
      } else {
        // Collapse section
        btn.textContent = '▶';
        if (cardGrid) cardGrid.style.display = 'none';
        if (toggle) toggle.style.display = 'none';
        if (viewAllLink) viewAllLink.style.display = 'none';
      }
    }
// --- SEARCH: filter cards, temporarily overriding collapse ---
    function filterCards() {
      const query = document.getElementById('search-input').value.toLowerCase().trim();
      const resultsLabel = document.getElementById('search-results');
      let matchCount = 0;

      document.querySelectorAll('.section').forEach(section => {
        // Skip "New Content" section to avoid duplicate results
        const sectionTitle = section.querySelector('.section-title');
        if (sectionTitle && sectionTitle.textContent.trim() === 'New Content') {
          return;
        }

        const cards = section.querySelectorAll('.card');
        const toggle = section.querySelector('.section-toggle');
        let sectionHasMatch = false;

        cards.forEach((card, i) => {
          const title = card.querySelector('.card-title').textContent.toLowerCase();
          const excerpt = card.querySelector('.card-excerpt').textContent.toLowerCase();
          const tag = card.querySelector('.card-tag').textContent.toLowerCase();
          const combined = title + ' ' + excerpt + ' ' + tag;
          const isMatch = query === '' || combined.includes(query);

          if (isMatch) {
            matchCount++;
            sectionHasMatch = true;
          }

          if (query === '') {
            // Search cleared — restore normal collapse state
            card.style.display = '';
            const toggle = section.querySelector('.section-toggle');
            const isExpanded = toggle && toggle.textContent === 'Show less';
            if (i >= MAX_VISIBLE && !isExpanded) {
              card.classList.add('card--hidden');
            }
          } else {
            // Searching — override collapse, show/hide based on match only
            card.classList.remove('card--hidden');
            card.style.display = isMatch ? 'flex' : 'none';
          }
        });

        // Show/hide the section and its toggle button
        section.style.display = (query === '' || sectionHasMatch) ? 'block' : 'none';
        if (toggle) {
          toggle.style.display = (query === '' && cards.length > MAX_VISIBLE) ? 'block' : 'none';
        }
      });

      // Update results label
      if (query === '') {
        resultsLabel.textContent = '';
      } else if (matchCount === 0) {
        resultsLabel.textContent = 'No results found.';
      } else {
        resultsLabel.textContent = matchCount + ' result' + (matchCount !== 1 ? 's' : '') + ' found.';
      }
    }

    // Run collapse on page load
    initCollapse();
  </script>

  <script src="includes.js"></script>
  <script src="home-content.js"></script>
</body>
</html>
